
#FIXME: remove this file when converted to rampass .. pwpush
server {
        listen 80;
        server_name {{ pwpush_domain }};
	include /etc/nginx/eqpress-common/common_cdn_realip.conf;
        return 301 https://{{ pwpush_domain }}$request_uri;
}

server {
        listen 443 ssl http2;
        server_name {{ pwpush_domain }};
        access_log /var/log/nginx/{{ pwpush_domain }}.access.log;
        error_log /var/log/nginx/{{ pwpush_domain }}.error.log;

	include /etc/nginx/eqpress-common/common_cdn_realip.conf;

	# FIXME - need certs for this domain
        include /etc/nginx/eqpress-common/common_eqpress_ssl.conf;

        root {{ eqpress_base_dir }}/pwpusher/pwpusher_public;
        index pw.php;

        location / {
                try_files $uri $uri/ /pw.php?$args =404;
        }

        location ~ \.php$ {
                expires 600;
                add_header X-Frame-Options SAMEORIGIN;
                include fastcgi_params;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                fastcgi_split_path_info ^(.+\.php)(/.+)$;
                fastcgi_index index.php;
                fastcgi_pass php{{ php_version }}-fpm-unix-sock;
        }
}
